"use strict";window.app=angular.module("lemonadeApp",["ui.router","app.filters","ngMessages","ngResource","restangular"]).run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c}]).config(["DistanceServiceProvider",function(a){a.setLatitude(40.001947),a.setLongitude(-75.278072)}]).config(["RestangularProvider",function(a){a.setBaseUrl("/data")}]).config(["RestangularProvider",function(a){a.setRequestInterceptor(function(a,b,c){var d={};return"transactions"===c&&"post"===b&&(d.healthySnack=a.transactionCount.healthySnack,d.treat=a.transactionCount.treats,d.largeLemonade=a.transactionCount.largeLemonade,d.mediumLemonade=a.transactionCount.mediumLemonade,d.totalLemonade=a.transactionLemonade,d.productTotal=a.transactionCountTotal,d.grossProfit=a.transactionCost,a=d),a})}]),app.controller("FooterController",["$scope","DistanceService",function(a,b){a.headquarter={distance:""},a.init=function(){var c=b.getDistance();c.then(function(b){a.headquarter.distance=b},function(a){console.log(a)})},a.init()}]),app.controller("GiveFormController",["$scope","PhilanthropistApiService",function(a,b){a.form={isNotSubmittable:!1,message:""},a.giver={name:"",phone:"",address:"",zipcode:"",email:"",contact:"Email"},a.addDonor=function(){var d={};a.giveForm.$valid?(d=b.addDonor(a.giver),d.then(function(){a.form.message="Thanks for donating"},function(){a.form.message="No go: backend down - try again"})):(a.form.message="We cannot add you: ",c())};var c=function(){a.giveForm.giverName.$invalid?a.form.message+="Please check your name input.":a.giveForm.phone.$invalid?a.form.message+="Please enter a phone number.":a.giveForm.zipcode.$invalid?a.form.message+="Please check your zipcode.":a.giveForm.email.$invalid&&(a.form.message+="Please check your email.")}}]),app.controller("GiveController",["$scope","CurrentLocationService",function(a,b){a.page={title:"Give",coords:""},a.init=function(){var c=b.getLocation();c.then(function(b){a.page.coords="Latitude: "+b.latitude+" & Longitude: "+b.longitude},function(a){console.log(a)})},a.init()}]),app.controller("HeaderController",["$scope",function(a){a.date={human:new Date,machine:new Date}}]),app.controller("HomeController",["$scope",function(a){a.page={title:"This one's on me"}}]),app.controller("ProductController",["$scope","TransactionService",function(a,b){a.updateQuantityAndCost=function(){a.transaction.transactionQuantity=b.getCurrentTransactionQuantity(),a.transaction.transactionCost=b.getCurrentTransactionCost()},a.incrementLargeLemonade=function(){b.incrementLargeLemonade(),a.transaction.largeLemonadeQuantity=b.getLargeLemonadeQuantity(),a.updateQuantityAndCost()},a.incrementMediumLemonade=function(){b.incrementMediumLemonade(),a.transaction.mediumLemonadeQuantity=b.getMediumLemonadeQuantity(),a.updateQuantityAndCost()},a.incrementHealthySnack=function(){a.transaction.healthySnackQuantity=b.incrementHealthSnack(),a.updateQuantityAndCost()},a.incrementTreat=function(){a.transaction.treatQuantity=b.incrementTreat(),a.updateQuantityAndCost()}}]),app.controller("ReportDonorsController",["$scope","$state","philanthropists","philanthropistApiService",function(a,b,c,d){a.donors=c,a.search={nameAndBestContact:""},a.messages={donorRemovalError:!1},a.searchNameAndBestContact=function(b){var c=!1;return(-1!==b.name.indexOf(a.search.nameAndBestContact)||-1!==b.bestContact.indexOf(a.search.nameAndBestContact))&&(c=!0),c},a.deleteDonor=function(c){var e=d.removeDonor(c);e.then(function(c){a.donors=c.toJSON().philanthropists,a.messages.donorRemovalError=!1,b.go("reports.donors")},function(){a.messages.donorRemovalError=!0})}}]),app.controller("ReportSalesController",["$scope",function(a){a.report={limit:10,selectedReport:""},a.setSelectedReport=function(b){a.report.selectedReport=b},a.sales=[{date:"1-1-2012",quantity:"500",netSale:"750",costOfGoods:"400"},{date:"2-1-2012",quantity:"425",netSale:"650",costOfGoods:"300"},{date:"3-1-2012",quantity:"300",netSale:"450",costOfGoods:"300"},{date:"4-1-2012",quantity:"600",netSale:"750",costOfGoods:"400"},{date:"5-1-2012",quantity:"100",netSale:"250",costOfGoods:"175"},{date:"6-1-2012",quantity:"100",netSale:"250",costOfGoods:"150"},{date:"7-1-2012",quantity:"425",netSale:"750",costOfGoods:"400"},{date:"8-1-2012",quantity:"300",netSale:"450",costOfGoods:"250"},{date:"9-1-2012",quantity:"650",netSale:"850",costOfGoods:"650"},{date:"10-1-2012",quantity:"100",netSale:"350",costOfGoods:"250"},{date:"11-1-2012",quantity:"100",netSale:"350",costOfGoods:"250"},{date:"12-1-2012",quantity:"300",netSale:"450",costOfGoods:"250"},{date:"1-1-2013",quantity:"300",netSale:"550",costOfGoods:"350"},{date:"2-1-2013",quantity:"650",netSale:"750",costOfGoods:"450"},{date:"3-1-2013",quantity:"300",netSale:"450",costOfGoods:"250"},{date:"4-1-2013",quantity:"650",netSale:"850",costOfGoods:"650"},{date:"5-1-2013",quantity:"100",netSale:"350",costOfGoods:"150"},{date:"6-1-2013",quantity:"100",netSale:"250",costOfGoods:"150"},{date:"7-1-2013",quantity:"500",netSale:"350",costOfGoods:"250"},{date:"8-1-2013",quantity:"500",netSale:"750",costOfGoods:"550"},{date:"9-1-2013",quantity:"650",netSale:"850",costOfGoods:"550"},{date:"10-1-2013",quantity:"300",netSale:"550",costOfGoods:"350"},{date:"11-1-2013",quantity:"100",netSale:"350",costOfGoods:"250"},{date:"12-1-2013",quantity:"150",netSale:"450",costOfGoods:"150"}]}]),app.controller("ReportTransactionsController",["$scope","transactions",function(a,b){a.transactions=b,a.deleteTransaction=function(){var b=this.transaction;b.remove().then(function(){a.transactions=_.without(a.transactions,b)})}}]),app.controller("ReportController",["$scope","$state",function(a,b){a.$state=b,a.page={title:"Reports"}}]),app.controller("SellController",["$scope","TransactionService","SuppliesService","error",function(a,b,c,d){var e={TOO_MANY_PRODUCTS:"Too many products the transaction won't work"};a.page={title:"Sell"},a.transaction={largeLemonadeQuantity:0,mediumLemonadeQuantity:0,healthySnackQuantity:0,treatQuantity:0,transactionQuantity:0,transactionCost:0,allowable:!1},a.cost={largeLemonade:0,mediumLemonade:0,healthySnack:0,treat:0},a.messages={error:""},a.completeOrder=function(){var c={};a.isTransactionAllowable()?(c=b.completeTransaction(),c.then(function(){a.updateSupplies(),a.messages.error=d.NO_ERROR},function(){a.messages.error=d.SYSTEM_ISSUE_ERROR}),c.finally(function(){a.clearTransaction()})):(a.clearTransaction(),a.messages.error=e.TOO_MANY_PRODUCTS)},a.isTransactionAllowable=function(){var a=!1;return b.isTransactionInitialized()&&c.isProductAvailable(b.getLemonadeQuantity(),b.getHealthySnackQuantity(),b.getTreatQuantity())&&(a=!0),a},a.init=function(){if(!c.isInitialized()){var e=c.initialize();e.then(function(){console.log("supplies service setup")}),e.catch(function(){console.log(d),a.messages.error=d.SYSTEM_ISSUE_ERROR})}if(!b.isTransactionInitialized()){var f=b.intializeTransaction();f.then(function(){a.cost.largeLemonade=b.getLargeLemonadeCost(),a.cost.mediumLemonade=b.getMediumLemonadeCost(),a.cost.healthySnack=b.getHealthySnackCost(),a.cost.treat=b.getTreatCost()},function(a){console.log(a.SYSTEM_ISSUE_ERROR)})}},a.updateSupplies=function(){c.setSupplies(b.getLemonadeQuantity(),b.getHealthySnackQuantity(),b.getTreatQuantity())},a.clearTransaction=function(){b.clearCurrentTransaction(),a.transaction.largeLemonadeQuantity=b.getMediumLemonadeQuantity(),a.transaction.mediumLemonadeQuantity=b.getLargeLemonadeQuantity(),a.transaction.healthySnackQuantity=b.getHealthySnackQuantity(),a.transaction.treatQuantity=b.getTreatQuantity(),a.transaction.transactionQuantity=b.getCurrentTransactionQuantity(),a.transaction.transactionCost=b.getCurrentTransactionCost()},a.init()}]),app.controller("SuppliesController",["$scope","suppliesService",function(a,b){a.page={title:"Supplies"},a.actual={lemonadeQuantity:b.getLemonadeQuantity(),healthySnackQuantity:b.getHealthySnackQuantity(),treatQuantity:b.getTreatQuantity()},a.maximum={lemonadeQuantity:100,healthySnackQuantity:50,treatQuantity:50}}]),app.directive("lemonTitle",function(){return{restrict:"AE",replace:!0,scope:!0,template:"<h2>{{page.title}}</h2>"}}),app.directive("lemonReportListing",function(){var a=["/src/images/thumbsUp.png","/src/images/smiley_face.jpg","/src/images/hands_clapping.png"];return{restrict:"EA",scope:{report:"=",action:"&",limit:"@"},transclude:!0,templateUrl:"/src/templates/directive/report-listing.html",controller:["$scope",function(a){a.report.grossProfit=a.report.netSale-a.report.costOfGoods,a.report.profitable=a.report.grossProfit>200?!0:!1,a.showSelected=function(){a.action({selectedReport:a.report})}}],link:function(b,c){var d;b.$watch("limit",function(){d=Math.round(2*Math.random()),console.log("imageChoice"+d),b.report.goodImage=a[d]}),c.bind("click",function(){c.parent().children().removeClass("selected"),c.addClass("selected")})}}}),angular.module("app.filters",[]).filter("showDate",["$filter",function(a){return function(b){return angular.isString(b)?a("date")(new Date(b),"mediumDate").toUpperCase():void 0}}]),app.constant("error",{SYSTEM_ISSUE_ERROR:"Sorry, we are having server issues",NO_ERRORS:"",DEPRECATED:"This has been deprecated"}),app.factory("PhilanthropistApiService",["$resource","DonorsResponseTansformer",function(a,b){var c=a("/data/philanthropists/:donor",{},{query:{method:"GET",isArray:!0,transformResponse:b}}),d=function(){return c.query().$promise},e=function(a){return c.save(a).$promise},f=function(a){return c.remove({donor:a}).$promise};return{getDonorsInformation:d,addDonor:e,removeDonor:f}}]),app.factory("SuppliesApiService",["$http","SuppliesResponseTransformer",function(a,b){var c=function(){return a({method:"GET",url:"/data/initial-supplies",transformResponse:b})},d=function(){return a({method:"GET",url:"/data/cost.json"})};return{getSupplyQuantities:c,getSupplyCosts:d}}]),app.factory("TransactionApiService",["Restangular","error",function(a,b){var c=a.all("transactions"),d=function(){return c.getList()},e=function(a){return c.post(a)},f=function(a){alert(b.DEPRECATED+" param:"+a)};return{getTransactions:d,addTransaction:e,removeTransaction:f}}]),app.factory("CurrentLocationService",["$q",function(a){var b=a.defer(),c=["Unknown error","Permission denied by user","Position is not available","Request timed out"],d=function(){return navigator.geolocation.getCurrentPosition(e,f),b.promise},e=function(a){b.resolve(a.coords)},f=function(a){var d=c[a.code];(0===a.code||2===a.code)&&(d+=" "+a.message),b.reject("Geolocation error: "+d)};return{getLocation:d}}]),app.provider("DistanceService",function(){var a=0,b=0;return{setLatitude:function(b){a=b},setLongitude:function(a){b=a},$get:["$q",function(c){var d=c.defer(),e=["Unknown error","Permission denied by user","Position is not available","Request timed out"],f=function(){return navigator.geolocation.getCurrentPosition(g,h),d.promise},g=function(a){var b=a.coords.latitude,c=a.coords.longitude,e=i(b,c);d.resolve(e)},h=function(a){var b=e[a.code];(0===a.code||2===a.code)&&(b+=" "+a.message),d.reject("Geolocation error: "+b)},i=function(c,d){var e=j(c),f=j(d),g=j(a),h=j(b),i=6371,k=Math.acos(Math.sin(e)*Math.sin(g)+Math.cos(e)*Math.cos(g)*Math.cos(f-h))*i;return parseInt(k)},j=function(a){var b=a*Math.PI/180;return b};return{getDistance:f}}]}}),app.factory("SuppliesService",["SuppliesApiService","error",function(a,b){var c=!1,d={lemonade:0,healthySnack:0,treat:0},e=function(a,b,c){d.lemonade=d.lemonade-a,d.healthySnack=d.healthySnack-b,d.treat=d.treat-c},f=function(){return a.getSupplyQuantities().then(function(a){var b=a.data;a.data&&(d.lemonade=b.lemonade,d.healthySnack=b.healthySnack,d.treat=b.treat,c=!0)},function(){console.log(b.SYSTEM_ISSUE_ERROR)})},g=function(a,b,c){var e=!1;return d.lemonade>=a&&d.healthySnack>=b&&d.treat>=c&&(e=!0),e},h=function(){return c},i=function(){return d.lemonade},j=function(){return d.healthySnack},k=function(){return d.treat};return{initialize:f,isInitialized:h,isProductAvailable:g,setSupplies:e,getLemonadeQuantity:i,getHealthySnackQuantity:j,getTreatQuantity:k}}]),app.factory("TransactionService",["TransactionApiService","SuppliesApiService","error",function(a,b,c){var d=!1,e=0,f=0,g=0,h=0,i={healthySnack:0,treats:0,mediumLemonade:0,largeLemonade:0},j=0,k=0,l=function(a){k+=a},m=function(){j+=1},n=function(){return i.largeLemonade++,l(g),m(),i.largeLemonade},o=function(){return i.mediumLemonade++,l(h),m(),i.mediumLemonade},p=function(){return i.healthySnack++,l(e),m(),i.healthySnack},q=function(){return i.treats++,l(f),m(),i.treats},r=function(){var a;for(a in i)i[a]=0;k=0,j=0},s=function(){return k},t=function(){return j},u=function(){return i.mediumLemonade+2*i.largeLemonade},v=function(){return i.mediumLemonade},w=function(){return i.largeLemonade},x=function(){return i.healthySnack},y=function(){return i.treats},z=function(){return g},A=function(){return h},B=function(){return e},C=function(){return f},D=function(){return d},E=function(){return b.getSupplyCosts().then(function(a){var b=a.data;e=b.healthySnack,f=b.treat,h=b.mediumLemonade,g=b.largeLemonade,d=!0},function(){console.log(c.SYSTEM_ISSUE_ERROR)})},F=function(){var b={transactionLemonade:u(),transactionCount:i,transactionCountTotal:j,transactionCost:k};return a.addTransaction(b)};return{intializeTransaction:E,isTransactionInitialized:D,incrementLargeLemonade:n,incrementMediumLemonade:o,incrementHealthSnack:p,incrementTreat:q,clearCurrentTransaction:r,completeTransaction:F,getCurrentTransactionQuantity:t,getCurrentTransactionCost:s,getLemonadeQuantity:u,getMediumLemonadeQuantity:v,getLargeLemonadeQuantity:w,getHealthySnackQuantity:x,getTreatQuantity:y,getLargeLemonadeCost:z,getMediumLemonadeCost:A,getHealthySnackCost:B,getTreatCost:C}}]),app.factory("DonorsResponseTansformer",function(){return function(a){var b=JSON.parse(a);return b.length&&(b=_.map(b,function(a){return{id:a.id,name:a.name,phone:a.phone,address:a.address,zipcode:a.zipcode,email:a.email,bestContact:a.contact}})),b}}),app.factory("SuppliesResponseTransformer",function(){return function(a){a=JSON.parse(a);var b={lemonade:a.lemonadeQuantity,healthySnack:a.healthySnackQuantity,treat:a.treatQuantity};return b}}),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/lemonaide/"),a.state("lemonaide",{url:"/lemonaide","abstract":!0,views:{"":{template:"<div ui-view></div>"},header:{templateUrl:"/src/templates/header.html",controller:"HeaderController"},footer:{templateUrl:"/src/templates/footer.html",controller:"FooterController"}}}).state("home",{url:"/",parent:"lemonaide",templateUrl:"/src/templates/home.html",controller:"HomeController"}).state("give",{url:"/give",parent:"lemonaide",templateUrl:"/src/templates/give.html",controller:"GiveController"}).state("supplies",{url:"/supplies",parent:"lemonaide",templateUrl:"/src/templates/supplies.html",resolve:{suppliesService:"SuppliesService",supplies:["suppliesService",function(a){return a.isInitialized()?void 0:a.initialize()}]},controller:"SuppliesController"})}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/lemonaide/reports","/lemonaide/reports/sales"),a.state("reports",{url:"/reports",parent:"lemonaide",templateUrl:"/src/templates/reports/reports.html",controller:"ReportController","abstract":!0}).state("reports.sales",{url:"/sales",templateUrl:"/src/templates/reports/sales.html",controller:"ReportSalesController"}).state("reports.donors",{url:"/donors",templateUrl:"/src/templates/reports/donors.html",resolve:{philanthropistApiService:"PhilanthropistApiService",philanthropists:["philanthropistApiService",function(a){return a.getDonorsInformation()}]},controller:"ReportDonorsController"}).state("reports.donors.donor",{url:"/:donor",templateUrl:"/src/templates/reports/donor.html",controller:["$scope","$stateParams","philanthropists",function(a,b,c){a.donor=_.find(c,function(a){return a.id===Number(b.donor)})}]}).state("reports.transactions",{url:"/transactions",templateUrl:"/src/templates/reports/transactions.html",resolve:{transactionApiService:"TransactionApiService",transactions:["transactionApiService",function(a){return a.getTransactions()}]},controller:"ReportTransactionsController"})}]),app.config(["$stateProvider",function(a){a.state("sell",{url:"/sell",parent:"lemonaide",templateUrl:"/src/templates/sell/sell.html",controller:"SellController"}).state("sell.lemonade",{url:"/lemonade",templateUrl:"/src/templates/sell/lemonade.html",controller:["$scope",function(a){a.info={description:"I love drinking this stuff",health:"Little lemon ... lots of sugar!"}}]}).state("sell.healthy",{url:"/healthy",templateUrl:"/src/templates/sell/healthy.html",controller:["$scope",function(a){a.info={description:"An apple a day keeps the doctor away"}}]}).state("sell.treat",{url:"/treat",templateUrl:"/src/templates/sell/treat.html",controller:["$scope",function(a){a.info={lifeSpan:-42}}]})}]);